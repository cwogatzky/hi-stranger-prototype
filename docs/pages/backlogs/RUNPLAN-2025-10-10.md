### üß≠ **Run Plan ‚Äî 2025-10-10 (Profile Edit, Active State, and Moderation Policy Layer)**

---

## **Scope**
Advance the prototype by finalizing the Profile UI (Edit & Active state), introducing Chat Owner & Meta logic foundations, and scaffolding the Moderation Policy Layer to personalize tone and behavior based on user traits.

---

## **Step 1 ‚Äî Profile Editing**
- Add inline edit form to each profile card (`js/ui/profileForm.js`).
- Populate form with existing data (name, language, formality, traits).
- Support Save & Cancel; validation via schemas (`isUserProfile`).
- Update profiles through `updateProfile()` in `profileStore.js`.
- Persist automatically through `AppStorage` (local adapter).

---

## **Step 2 ‚Äî Active Profile Logic**
- Extend `profileStore` to track `active_profile_id`.
- Add ‚ÄúSet Active‚Äù button in each profile card (visual highlight when selected).
- Auto-persist selection and make it globally available.
- On boot, ensure at least one active profile exists (`ensureActiveProfile()`).

---

## **Step 3 ‚Äî Chat Owner & Meta Foundation**
- Implement `js/state/chatMeta.js`: hold owner/type/goal/languages.
- Implement `js/logic/chatOwner.js`:
  - `ensureOwnerOnFirstUser()` assigns first user as chat owner.
  - `transferOwnership(newOwnerId)` allows reassignment.
  - Owner-only action: `startIntro()` (stub).
- Emit `chatmeta:changed` events for UI or moderation sync.
- Prepare integration between `active_profile` and chat owner reference.

---

## **Step 4 ‚Äî Moderation Policy Layer (Personality Mapping)**
- Create `js/moderation/policies.js` to map `profile.traits` ‚Üí `policy`.
  - Example: ‚Äúcalm‚Äù ‚Üí lower intervention; ‚Äúhumorous‚Äù ‚Üí relaxed tone.
- Extend `js/moderation/promptBuilder.js` to include policy tokens (tone, style, empathy).
- Add draft `policyConfig.json` for future expansion.
- Keep implementation dry-run (no OpenAI calls yet).

---

## **Step 5 ‚Äî i18n Portuguese Layer**
- Create `system.pt.js` and register it in i18n setup.
- Ensure parity with `system.en.js`, `system.de.js`, and `system.es.js`.
- Begin populating base strings for moderation/system texts.
- Add verification helper (`validateLanguagePack('pt')`) to detect missing keys.

---

## **Step 6 ‚Äî Documentation Updates**
- Update **SCRIPT_ARCHITECTURE.md** with new modules (ChatMeta, ChatOwner, Policies, i18n).
- Update **DATA_STORAGE_CONCEPT.md** with `active_profile_id` and owner references.
- Add a new **README.md** section ‚ÄúProfile System Overview‚Äù.

---

## **Step 7 ‚Äî Tests & Smoke Validation**
- Verify end-to-end CRUD + Edit + Active Profile behavior.
- Ensure owner auto-assignment works correctly.
- Test moderation dry-run policies for multiple trait types.
- Validate persistence (reload consistency).

---

## **Deliverables**
- Fully functional **Profile Edit & Active Profile** flow.  
- **Chat Owner** and **Meta** scaffolding ready for integration.  
- **Moderation Policy Layer** generating policy mappings.  
- Portuguese system file initialized.  
- Documentation and architecture updated.

---

‚úÖ Ready for day 2 of the **Profile‚ÄìOwner‚ÄìPolicy MVP** sprint.