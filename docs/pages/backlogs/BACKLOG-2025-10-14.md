# ğŸ’¡ HI STRANGER CHAT PROTOTYPE â€” BACKLOG (14.10.2025)

---

ğŸš¨ 3. Storage Refactor (LIVE-Ready) â€” PRIORITY TODAY
	â€¢	Goal: Server is Source of Truth, Browser is Runtime Cache. NDJSON bulk import + JSON Schema validation.
	â€¢	APIs:
	â€¢	POST /profiles/import (NDJSON/NDJSON.GZ, streaming, Ajv per line)
	â€¢	GET /profiles/:id (ETag/rev)
	â€¢	GET /profiles?cursor=&q= (paging/filter)
	â€¢	GET /profiles/changes?since_rev= (delta feed)
	â€¢	(optional) GET /profiles/events (SSE invalidations)
	â€¢	Storage: R2/S3 (raw shards) + SQL (index/search) + KV (hot cache).
	â€¢	Consistency: ETag/sha256, rev, last_modified.
	â€¢	Client: IndexedDB cache (profiles store), write-through, delta-sync on boot.
	â€¢	Conflicts: fieldwise 3-way merge; critical fields prompt; recompute behavior_vector.
	â€¢	Observability: validation report, metrics (import rate, error %, p95), checksums.
	â€¢	Docs: ARCHITECTURE/WORKFLOWS/REFERENCE/SECURITY_PRIVACY updated.

â¸»

âš™ï¸ 4. Chat Owner Logic (UPDATED)
	â€¢	Owner is set via Profile selection (no longer â€œfirst created userâ€).
	â€¢	Owner automatically gets chat_owner: true.
	â€¢	Owner Badge in phone frame (â€œchat ownerâ€).
	â€¢	Owner changeable until chat start, then locked.
	â€¢	Owner can trigger room-wide actions (e.g., â€œStart intro for newcomersâ€).

â¸»

ğŸ§  5. Intro Logic Extension
	â€¢	System message â€œXY has joined the chatâ€ (localized).
	â€¢	Owner button â€œStart intro for new participantsâ€.
	â€¢	Track hasIntroduced: true/false.

â¸»

ğŸ§© 6. Code Modularization (EXPANDED)
	â€¢	Split script.js â†’ modules:
	â€¢	/ui/ownerPanel.js
	â€¢	/ui/addUserPanel.js
	â€¢	/ui/frames.js
	â€¢	/flow/intro.js
	â€¢	/flow/payload.js
	â€¢	/net/makeClient.js
	â€¢	/state/chatMeta.js (existing)
	â€¢	/state/profileStore.js (existing)
	â€¢	/ui/typing.js
	â€¢	Define event contracts & namespace conventions (window.App â†’ submodules).
	â€¢	Reduce globals to App.*.

â¸»

ğŸ¨ 7. CSS Concept & Extraction (NEW)
	â€¢	Move inline CSS from index.html to /styles/prototype.css.
	â€¢	Design tokens & utilities (spacing, radius, font scale, color vars).
	â€¢	Standardize:
	â€¢	Buttons (.btn-primary, .btn-secondary, .btn-disabled)
	â€¢	Panels / Floating Panels
	â€¢	Badges / Labels
	â€¢	Frames / Device Container
	â€¢	Remove style-in-JS.
	â€¢	Structure:
/styles/
â”œâ”€â”€ prototype.css (global)
â”œâ”€â”€ chat.css (bubbles, frames, messages)
â””â”€â”€ ui.css (buttons, panels, modals)

â¸»

ğŸ§­ 8. Clear Init Sequence
	â€¢	boot() â†’ UI â†’ Presets â†’ Events â†’ Moderation Flow.
	â€¢	Document unified App.init() pipeline.

â¸»

ğŸ§© 9. Debug Wrapper
	â€¢	Global flag App.debug = true/false.
	â€¢	Wrapper App.log() â†’ console.debug() when enabled.

â¸»

ğŸ“„ 10. Documentation & Dev Collaboration
	â€¢	Update DEV_COLLAB_GUIDE.md:
	â€¢	Session steps, file versioning, patch order.
	â€¢	Lightbox rule: â€œmax 1 large-file patch at a time.â€
	â€¢	DONE/Backlog workflow.
	â€¢	Update README.md with:
	â€¢	Setup, file structure (after split)
	â€¢	Dev workflow & lint rules
	â€¢	Local run guide

â¸»

ğŸ§° 12. User Profiles & Data Model (PHASE 2)
	â€¢	Blocked by 3 (Storage Refactor) â€” start after 3 is DONE.
	â€¢	Full integration of USER_PROFILE.md:
	â€¢	Form fields (Name, Age, Traits, Tone, Language, Country, Goals).
	â€¢	Compute age from birthday.
	â€¢	Inline validation + updateProfile() flow.
	â€¢	Add RuntimeState: { joined_at, hasIntroduced, lastActive, traitFlags }.
	â€¢	Add Import/Export (Profiles page) using NDJSON and schema.

â¸»

ğŸ§  13. Chat UI Profile Integration (EXPANDED)
	â€¢	Profile data visible in Chat:
	â€¢	Name (done)
	â€¢	Language â†’ (cc) label (done)
	â€¢	Tone, Traits, Goals â†’ new badges under the name
	â€¢	No layout shift: badges inline-block, max 2 lines.
	â€¢	System messages â€œXY joined / introducedâ€ visible in Chat.
	â€¢	Smooth animation for new user frame mount.

â¸»

ğŸ¤– 14. Moderation Logic (AI)
	â€¢	Prompt extends with full profiles[] data.
	â€¢	Late-joiner catch-up intro for hasIntroduced=false.
	â€¢	Summary & reflection consider Traits & Goals.

â¸»

ğŸ­ 14b. Personality Layer (POLICIES)
	â€¢	Map profile.traits â†’ moderation.policies.
	â€¢	Examples: â€œhumorousâ€, â€œcalmâ€, â€œconflict-averseâ€, â€œdominantâ€.
	â€¢	AI moderation picks matching tonality dynamically.

â¸»

ğŸ”„ 15. Make / OpenAI Flow
	â€¢	Payload extends with:
	â€¢	profiles[], joined_user_ids, has_introduced_map.
	â€¢	Add action: start_catchup_intro(new_user_ids[]).
	â€¢	Validate strict JSON Schema + error recovery.

â¸»

ğŸ’¾ 16. Persistence & Storage (MERGED into 3)
	â€¢	Previous generic persistence ticket is now covered by 3; keep as reference only.

â¸»

ğŸ§© 19. UX-Polish & Overlays
	â€¢	Floating panels:
	â€¢	Click-outside close, ESC close, focus handling
	â€¢	ARIA roles (role="list", role="listitem")
	â€¢	Key navigation (Up/Down + Enter)
	â€¢	Panel engine â†’ /ui/panel.js.

â¸»

ğŸ§© 20. i18n Extension
	â€¢	New strings:
	â€¢	â€œhas joined the chatâ€
	â€¢	â€œIntro startedâ€
	â€¢	â€œProfile updatedâ€
	â€¢	Add Portuguese system copy (system.pt.js).
	â€¢	Cultural tone tuning (PT vs. BR).

â¸»

ğŸ§ª 21. Testing & Quality
	â€¢	Regression: Owner panel, Add-User, Start-Chat, Intro flow.
	â€¢	Validate payloads with profiles.
	â€¢	Cross-browser flex layout check (Safari, Edge).
	â€¢	Ensure strict ES module imports (no 404s).

â¸»

ğŸ§­ 22. Documentation Extensions
	â€¢	Add/Update:
	â€¢	ARCHITECTURE.md
	â€¢	WORKFLOWS.md
	â€¢	REFERENCE.md
	â€¢	DECISIONS (ADR).md
	â€¢	PLAYBOOKS.md
	â€¢	SECURITY_PRIVACY.md: add Profile Data + Browser Cache usage.
	â€¢	Initialize ROADMAP_BACKLOG.md.

â¸»

ğŸ§© 23. Parameter Concept
	â€¢	Revise old parameterkonzept.txt.
	â€¢	Document all variables, triggers, input fields.
	â€¢	Structure: params.make.json + params.ai.json.

â¸»

ğŸ¨ 24. Chat UI Concept
	â€¢	Roles UI (Owner, Participants, Moderator).
	â€¢	Input dynamics & feedback states.
	â€¢	Wireframes & flow visualization.

â¸»

ğŸ’¬ 25. Chat Visual Design
	â€¢	Chat bubbles, color flow, micro animations.
	â€¢	Smooth transitions system/user.
	â€¢	Hover/focus states, shadows, subtle delays.

â¸»

ğŸ§­ 26. Chat Journey Concept
	â€¢	Journey map: onboarding â†’ intro â†’ conversation â†’ reflection â†’ closing.
	â€¢	Visualize & define narrative flow.

â¸»

ğŸš€ 27. CF Deployment / Docs Viewer
	â€¢	Test Pages functions setup.
	â€¢	Optional: 404 fallback, index redirect, hardening.