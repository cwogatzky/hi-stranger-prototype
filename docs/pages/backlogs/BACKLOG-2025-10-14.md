# 💡 HI STRANGER CHAT PROTOTYPE — BACKLOG (14.10.2025)

---

🚨 3. Storage Refactor (LIVE-Ready) — PRIORITY TODAY
	•	Goal: Server is Source of Truth, Browser is Runtime Cache. NDJSON bulk import + JSON Schema validation.
	•	APIs:
	•	POST /profiles/import (NDJSON/NDJSON.GZ, streaming, Ajv per line)
	•	GET /profiles/:id (ETag/rev)
	•	GET /profiles?cursor=&q= (paging/filter)
	•	GET /profiles/changes?since_rev= (delta feed)
	•	(optional) GET /profiles/events (SSE invalidations)
	•	Storage: R2/S3 (raw shards) + SQL (index/search) + KV (hot cache).
	•	Consistency: ETag/sha256, rev, last_modified.
	•	Client: IndexedDB cache (profiles store), write-through, delta-sync on boot.
	•	Conflicts: fieldwise 3-way merge; critical fields prompt; recompute behavior_vector.
	•	Observability: validation report, metrics (import rate, error %, p95), checksums.
	•	Docs: ARCHITECTURE/WORKFLOWS/REFERENCE/SECURITY_PRIVACY updated.

⸻

⚙️ 4. Chat Owner Logic (UPDATED)
	•	Owner is set via Profile selection (no longer “first created user”).
	•	Owner automatically gets chat_owner: true.
	•	Owner Badge in phone frame (“chat owner”).
	•	Owner changeable until chat start, then locked.
	•	Owner can trigger room-wide actions (e.g., “Start intro for newcomers”).

⸻

🧠 5. Intro Logic Extension
	•	System message “XY has joined the chat” (localized).
	•	Owner button “Start intro for new participants”.
	•	Track hasIntroduced: true/false.

⸻

🧩 6. Code Modularization (EXPANDED)
	•	Split script.js → modules:
	•	/ui/ownerPanel.js
	•	/ui/addUserPanel.js
	•	/ui/frames.js
	•	/flow/intro.js
	•	/flow/payload.js
	•	/net/makeClient.js
	•	/state/chatMeta.js (existing)
	•	/state/profileStore.js (existing)
	•	/ui/typing.js
	•	Define event contracts & namespace conventions (window.App → submodules).
	•	Reduce globals to App.*.

⸻

🎨 7. CSS Concept & Extraction (NEW)
	•	Move inline CSS from index.html to /styles/prototype.css.
	•	Design tokens & utilities (spacing, radius, font scale, color vars).
	•	Standardize:
	•	Buttons (.btn-primary, .btn-secondary, .btn-disabled)
	•	Panels / Floating Panels
	•	Badges / Labels
	•	Frames / Device Container
	•	Remove style-in-JS.
	•	Structure:
/styles/
├── prototype.css (global)
├── chat.css (bubbles, frames, messages)
└── ui.css (buttons, panels, modals)

⸻

🧭 8. Clear Init Sequence
	•	boot() → UI → Presets → Events → Moderation Flow.
	•	Document unified App.init() pipeline.

⸻

🧩 9. Debug Wrapper
	•	Global flag App.debug = true/false.
	•	Wrapper App.log() → console.debug() when enabled.

⸻

📄 10. Documentation & Dev Collaboration
	•	Update DEV_COLLAB_GUIDE.md:
	•	Session steps, file versioning, patch order.
	•	Lightbox rule: “max 1 large-file patch at a time.”
	•	DONE/Backlog workflow.
	•	Update README.md with:
	•	Setup, file structure (after split)
	•	Dev workflow & lint rules
	•	Local run guide

⸻

🧰 12. User Profiles & Data Model (PHASE 2)
	•	Blocked by 3 (Storage Refactor) — start after 3 is DONE.
	•	Full integration of USER_PROFILE.md:
	•	Form fields (Name, Age, Traits, Tone, Language, Country, Goals).
	•	Compute age from birthday.
	•	Inline validation + updateProfile() flow.
	•	Add RuntimeState: { joined_at, hasIntroduced, lastActive, traitFlags }.
	•	Add Import/Export (Profiles page) using NDJSON and schema.

⸻

🧠 13. Chat UI Profile Integration (EXPANDED)
	•	Profile data visible in Chat:
	•	Name (done)
	•	Language → (cc) label (done)
	•	Tone, Traits, Goals → new badges under the name
	•	No layout shift: badges inline-block, max 2 lines.
	•	System messages “XY joined / introduced” visible in Chat.
	•	Smooth animation for new user frame mount.

⸻

🤖 14. Moderation Logic (AI)
	•	Prompt extends with full profiles[] data.
	•	Late-joiner catch-up intro for hasIntroduced=false.
	•	Summary & reflection consider Traits & Goals.

⸻

🎭 14b. Personality Layer (POLICIES)
	•	Map profile.traits → moderation.policies.
	•	Examples: “humorous”, “calm”, “conflict-averse”, “dominant”.
	•	AI moderation picks matching tonality dynamically.

⸻

🔄 15. Make / OpenAI Flow
	•	Payload extends with:
	•	profiles[], joined_user_ids, has_introduced_map.
	•	Add action: start_catchup_intro(new_user_ids[]).
	•	Validate strict JSON Schema + error recovery.

⸻

💾 16. Persistence & Storage (MERGED into 3)
	•	Previous generic persistence ticket is now covered by 3; keep as reference only.

⸻

🧩 19. UX-Polish & Overlays
	•	Floating panels:
	•	Click-outside close, ESC close, focus handling
	•	ARIA roles (role="list", role="listitem")
	•	Key navigation (Up/Down + Enter)
	•	Panel engine → /ui/panel.js.

⸻

🧩 20. i18n Extension
	•	New strings:
	•	“has joined the chat”
	•	“Intro started”
	•	“Profile updated”
	•	Add Portuguese system copy (system.pt.js).
	•	Cultural tone tuning (PT vs. BR).

⸻

🧪 21. Testing & Quality
	•	Regression: Owner panel, Add-User, Start-Chat, Intro flow.
	•	Validate payloads with profiles.
	•	Cross-browser flex layout check (Safari, Edge).
	•	Ensure strict ES module imports (no 404s).

⸻

🧭 22. Documentation Extensions
	•	Add/Update:
	•	ARCHITECTURE.md
	•	WORKFLOWS.md
	•	REFERENCE.md
	•	DECISIONS (ADR).md
	•	PLAYBOOKS.md
	•	SECURITY_PRIVACY.md: add Profile Data + Browser Cache usage.
	•	Initialize ROADMAP_BACKLOG.md.

⸻

🧩 23. Parameter Concept
	•	Revise old parameterkonzept.txt.
	•	Document all variables, triggers, input fields.
	•	Structure: params.make.json + params.ai.json.

⸻

🎨 24. Chat UI Concept
	•	Roles UI (Owner, Participants, Moderator).
	•	Input dynamics & feedback states.
	•	Wireframes & flow visualization.

⸻

💬 25. Chat Visual Design
	•	Chat bubbles, color flow, micro animations.
	•	Smooth transitions system/user.
	•	Hover/focus states, shadows, subtle delays.

⸻

🧭 26. Chat Journey Concept
	•	Journey map: onboarding → intro → conversation → reflection → closing.
	•	Visualize & define narrative flow.

⸻

🚀 27. CF Deployment / Docs Viewer
	•	Test Pages functions setup.
	•	Optional: 404 fallback, index redirect, hardening.