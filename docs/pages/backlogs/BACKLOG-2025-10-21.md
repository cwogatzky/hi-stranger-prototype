# üí° HI STRANGER CHAT PROTOTYPE ‚Äî BACKLOG (21.10.2025)

---

### ‚öôÔ∏è System & Infrastructure

**1. `_files.json` Auto-Generator (NEW)**
  ‚Ä¢ Goal: Automate generation of `/docs/pages/_files.json`.
  ‚Ä¢ Script scans `/docs/pages/` recursively for `.md` files.
  ‚Ä¢ Outputs a sorted JSON list to `_files.json`.
  ‚Ä¢ Can run via `npm run docs:refresh` or CLI (`node tools/generateDocsIndex.mjs`).
  ‚Ä¢ Add to Developer Briefs (`LOCAL_DEV_SETUP.md`).

**2. Docs Folder Watcher (IDEA)**
  ‚Ä¢ Optional watch task to auto-update `_files.json` on file change.
  ‚Ä¢ Integrate into local dev mode (Wrangler not required).
  ‚Ä¢ Future optional addition to live worker (KV cache refresh).

---

### üß† Core Chat Logic

**4. Chat Owner Logic (UPDATED)**
  ‚Ä¢ Owner set via Profile selection (`chat_owner: true`).
  ‚Ä¢ Owner badge visible in chat UI.
  ‚Ä¢ Changeable until chat start, then locked.
  ‚Ä¢ Owner can trigger room-wide actions (‚ÄúStart intro for newcomers‚Äù).

**5. Intro Logic Extension**
  ‚Ä¢ System message ‚ÄúXY has joined the chat‚Äù.
  ‚Ä¢ Owner button ‚ÄúStart intro for new participants‚Äù.
  ‚Ä¢ Track `hasIntroduced: true/false`.

---

### üß© Architecture & Code

**7. CSS Concept & Extraction**
  ‚Ä¢ Move inline CSS ‚Üí `/styles/`.
  ‚Ä¢ Design tokens, standardized classes, modular separation.

**9. Debug Wrapper**
  ‚Ä¢ Global flag `App.debug`.
  ‚Ä¢ Wrapper `App.log()` ‚Üí `console.debug()` when enabled.

**10. JS Architecture (NEW)**
  ‚Ä¢ Simplify core files (`index.html`, `profiles.html`, `script.js`) by outsourcing larger logic blocks into separate, self-contained modules.
  ‚Ä¢ Create distinct feature scripts (e.g. `profile-editor.js`, `profile-generator.js`, `profile-bulk-upload.js`).
  ‚Ä¢ Improves code readability and maintainability; descriptive filenames clarify purpose.
  ‚Ä¢ Define and document inter-module communication and structure in a dedicated `.md`.

**11. CSS Architecture (NEW)**
  ‚Ä¢ Establish layered CSS system: one global `styles.css` for tokens, reset, layout, shared components.
  ‚Ä¢ Add one page-specific stylesheet per view (`index.css`, `profiles.css`, etc.) scoped via `body[data-page]` selectors.
  ‚Ä¢ Optional `/components/` folder for reusable patterns (e.g. buttons, modals).
  ‚Ä¢ Keeps global CSS lean and makes page styles independent and predictable.

---

### üíæ Data & Profiles

**13. Chat UI Profile Integration**
  ‚Ä¢ Display traits, tone, goals as badges under name.
  ‚Ä¢ Smooth animation for joins; localized system messages.

---

### ü§ñ Moderation & AI

**14. Moderation Logic (AI)**
  ‚Ä¢ Prompt uses full `profiles[]` data.
  ‚Ä¢ Catch-up intro for `hasIntroduced=false`.
  ‚Ä¢ Summary considers traits and goals.

**14b. Personality Layer (POLICIES)**
  ‚Ä¢ Map `profile.traits` ‚Üí `moderation.policies`.
  ‚Ä¢ AI tone selection (‚Äúhumorous‚Äù, ‚Äúcalm‚Äù, etc.).

**15. Make / OpenAI Flow**
  ‚Ä¢ Payload: `{ profiles[], joined_user_ids, has_introduced_map }`.
  ‚Ä¢ Add action `start_catchup_intro(new_user_ids[])`.
  ‚Ä¢ Validate strict JSON Schema + error recovery.

---

### üß† Development Quality (UPDATED)

**27. Core Tooling Setup (PARTIAL)**
  ‚Ä¢ Add TypeScript strict mode for early type safety.
  ‚Ä¢ Integrate Zod for JSON schema validation of all AI/Make.com payloads.
  ‚Ä¢ Add ESLint + Prettier for clean and consistent code formatting.
  ‚Ä¢ Configure Husky + Lint-Staged to block faulty commits.
  ‚Ä¢ Add GitHub Actions for lint/typecheck automation.
  ‚Ä¢ Use VS Code (or Phoenix) with TS/ESLint plugins for instant inline feedback.
  ‚Ä¢ Implement OpenAPI/tRPC for typed API contracts between frontend and worker.

**30. Prompt & Schema Versioning**
  ‚Ä¢ Store all moderation prompts + Zod schemas with version tags under `/shared/promptstore/`.
  ‚Ä¢ Allows rollback and audit trail for moderation behaviour.

**31. Dev Efficiency Enhancements**
  ‚Ä¢ Add `tools/cli.mjs` for unified commands (build, lint, docs, test).
  ‚Ä¢ Optional hot-reload for docs + frontend preview.

**32. Error Tracking & Logs (Lightweight)**
  ‚Ä¢ Central `App.error()` wrapper ‚Üí writes error summary to KV or console (depending on DEBUG).
  ‚Ä¢ Enables minimal log persistence for prototype phase.

**33. Shared Schemas Package (Future)**
  ‚Ä¢ Move `zod` definitions to `/shared/schemas/` for reuse in Workers, Make.com, and UI.

---

### üß™ Extended Tooling & Performance (NEW)

**28. Secondary Tooling & Performance (LATER)**
  ‚Ä¢ Integrate Vitest for core parser/schema tests.
  ‚Ä¢ Add MSW for mocked API responses during offline/local testing.
  ‚Ä¢ Evaluate Playwright for end-to-end UI regression tests.
  ‚Ä¢ Switch to pnpm for faster package installs (optional).
  ‚Ä¢ Consider Turborepo if project expands to multi-package structure.

---

### üß© UI & Experience

**19. UX Polish & Overlays**
  ‚Ä¢ Floating panels: ESC close, click-outside close, focus handling.
  ‚Ä¢ ARIA roles, keyboard navigation.

**20. i18n Extension**
  ‚Ä¢ New strings (‚Äúhas joined‚Äù, ‚ÄúIntro started‚Äù, ‚ÄúProfile updated‚Äù).
  ‚Ä¢ Add Portuguese system copy (`system.pt.js`).
  ‚Ä¢ Cultural tone tuning (PT vs BR).

---

### üß™ Testing & Docs

**21. Testing & Quality**
  ‚Ä¢ Regression tests: Owner, Add-User, Intro flow.
  ‚Ä¢ Schema validation (NDJSON).
  ‚Ä¢ Cross-browser checks (Safari, Edge).
  ‚Ä¢ Ensure strict ES module imports (no 404s).

---

### üß© Parameters & UI Concepts

**23. Parameter Concept**
  ‚Ä¢ Rebuild param definitions (`params.make.json`, `params.ai.json`).
  ‚Ä¢ Document all triggers & inputs.

**24. Chat UI Concept**
  ‚Ä¢ Define roles (Owner, Participants, Moderator).
  ‚Ä¢ Input dynamics, feedback states, wireframes.

**25. Chat Visual Design**
  ‚Ä¢ Chat bubble colors, transitions, micro-animations.
  ‚Ä¢ State feedback and subtle motion refinements.

**26. Chat Journey Concept**
  ‚Ä¢ Journey map: onboarding ‚Üí intro ‚Üí conversation ‚Üí reflection ‚Üí close.
  ‚Ä¢ Visualize narrative flow and system tone.

---

### üß© Known Bugs

**B1. Duplicate user names during profile generation**
  ‚Ä¢ Users with same base name (e.g., `Robin_1`) appear multiple times.
  ‚Ä¢ Expected: auto-increment unique suffix or deduplication logic.

**B2. ‚ÄúSelect Chat Owner‚Äù button on `index.html` not functional**
  ‚Ä¢ Button press has no effect (no modal / owner select event triggered).
  ‚Ä¢ Regression after modularization.

**B3. Profile save after edit not persisting**
  ‚Ä¢ Editing in `profiles.html` updates fields locally but does not store back to KV.
  ‚Ä¢ Root cause: missing PUT handler or misaligned `item.js` update logic.
